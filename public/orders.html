<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Orders</title>

    <!-- ✅ Bootstrap & SweetAlert -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.16.1/sweetalert2.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.16.1/sweetalert2.min.js"></script>
</head>
<body>
    <!-- ✅ Dynamic Header -->
    <div id="header"></div>

    <div class="container mt-4">
        <h3 class="mb-3">My Orders</h3>
        <table class="table table-bordered" id="myOrdersTable">
            <thead class="thead-dark">
                <tr>
                    <th>Order ID</th>
                    <th>Date Placed</th>
                    <th>Date Shipped</th>
                    <th>Date Delivered</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr><td colspan="6" class="text-center">Loading...</td></tr>
            </tbody>
        </table>
    </div>

    <!-- ✅ Review Modal -->
    <div class="modal fade" id="reviewModal" tabindex="-1" aria-labelledby="reviewModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reviewModalLabel">Submit Review</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="review_orderinfo_id">
                    <input type="hidden" id="review_product_id">

                    <div class="form-group">
                        <label for="review_rating">Rating (1-5)</label>
                        <select id="review_rating" class="form-control">
                            <option value="1">1 - Very Bad</option>
                            <option value="2">2 - Bad</option>
                            <option value="3">3 - Okay</option>
                            <option value="4">4 - Good</option>
                            <option value="5">5 - Excellent</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="review_text">Review</label>
                        <textarea id="review_text" class="form-control" rows="3" placeholder="Write your review..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="submitReviewBtn">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let userId;

        $(document).ready(function () {
            const token = localStorage.getItem("token");
            userId = localStorage.getItem("userId");

            if (!token || !userId) {
                Swal.fire({
                    icon: "warning",
                    text: "You must be logged in first!",
                    showConfirmButton: true,
                }).then(() => {
                    window.location.href = "/login.html";
                });
                return;
            }

            // ✅ Load header (same as home.html)
            $("#header").load("/header.html", function () {
                const headerHeight = $("#header").outerHeight() || 60;
                $("body").css("padding-top", headerHeight + 20 + "px");

                $("#login-link, #register-link").addClass("d-none");
                $("#user-dropdown").removeClass("d-none");

                $.ajax({
                    url: `/api/v1/customers/${userId}`,
                    method: "GET",
                    success: function (res) {
                        if (res.success && res.data) {
                            const data = res.data;
                            const fullName = `${data.fname || ""} ${data.lname || ""}`.trim();
                            $("#username").text(fullName || "USER");
                            if (data.image_path) {
                                $(".profile-img").attr("src", `/${data.image_path}`);
                            }
                        }
                    }
                });
            });
        });
    </script>

    <!-- ✅ Orders & Review Logic -->
    <script src="js/user.js"></script>
</body>
</html>
